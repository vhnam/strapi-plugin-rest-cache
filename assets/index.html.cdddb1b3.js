import{f as i,b as r,c,g as n,h as a,i as t,F as l,j as p,k as s}from"./app.0455fa15.js";import{_ as u}from"./plugin-vue_export-helper.21dcd24c.js";const h={},d=p('<h1 id="strapi-plugin-rest-cache" tabindex="-1"><a class="header-anchor" href="#strapi-plugin-rest-cache" aria-hidden="true">#</a> strapi-plugin-rest-cache</h1><p>This plugin provide a way to cache <strong>HTTP requests</strong> in order to <strong>improve performance</strong>. It&#39;s get inspired by varnish cache which is a popular caching solution.</p><p>The cache content is stored by a <strong>provider</strong>, which can be either an in-memory provider, a redis connection, a file system, or any other custom provider. You can set a <strong>strategy</strong> to tell what to cache and how much time responses should be cached. The cache will be invalidated when the related Content-Type is updated, so you <strong>never have to worry about stale data</strong>.</p><p>In addition, you can interact with the plugin through the admin panel, api admin routes or programmatically using internal services.</p><h2 id="provider" tabindex="-1"><a class="header-anchor" href="#provider" aria-hidden="true">#</a> Provider</h2><p>By default, the <strong>strapi-plugin-rest-cache</strong> has no provider, you have to install one of the following providers:</p>',6),b=n("li",null,[n("strong",null,"strapi-provider-rest-cache-memory"),s(": In-memory provider, it's not persisted and will be lost when the server restarts.")],-1),g=n("strong",null,"strapi-provider-rest-cache-redis",-1),m=s(": Bridge between the cache plugin and the "),k={href:"https://github.com/strapi-community/strapi-plugin-redis",target:"_blank",rel:"noopener noreferrer"},v=s("strapi-plugin-redis"),y=p(`<p>You have to set the provider name in the plugin configuration so it will be initialized once the plugin is bootstrapped. At this time only one provider can be used at a time.</p><p>You can also set the provider <code>getTimeout</code> which is the time in milliseconds to wait for the provider to respond, <strong>if the provider is not responding, the cache will be considered as a miss</strong>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// file: /config/plugins.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> env <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&#39;rest-cache&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">,</span>
      <span class="token literal-property property">provider</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// name can be an alias:</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;my-provider&quot;</span><span class="token punctuation">,</span> <span class="token comment">// try to require &#39;strapi-provider-rest-cache-my-provider&#39;</span>
        <span class="token comment">// a full package name:</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;@org/my-cache-provider&quot;</span><span class="token punctuation">,</span> <span class="token comment">// try to require &#39;@org/my-cache-provider&#39;</span>
        <span class="token comment">// or a relative path:</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;../path/to/my-provider&quot;</span><span class="token punctuation">,</span>

        <span class="token comment">// provider options</span>
        <span class="token literal-property property">getTimeout</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token comment">// in milliseconds (default: 500)</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Note that each provider has its own configuration, so you will have to refer to the provider documentation to know how to configure it.</p>`,4),_={class:"custom-container tip"},f=n("p",{class:"custom-container-title"},"TIP",-1),w=s("Check the "),T=s("memory provider"),C=s(" and the "),x=s("redis provider"),j=s(" documentation for more details."),q=p(`<h2 id="strategy" tabindex="-1"><a class="header-anchor" href="#strategy" aria-hidden="true">#</a> Strategy</h2><p>The plugin will <strong>only inject cache middleware to Content-Types which have been explicitely enabled</strong>. This can be done by setting the <code>config.strategy.contentTypes</code> configuration.</p><p>It accept either a string or an object, so we can configure differently each Content-Type.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// file: /config/plugins.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> env <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&#39;rest-cache&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">,</span>
      <span class="token literal-property property">provider</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token comment">/* @type {CachePluginStrategy} */</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">contentTypes</span><span class="token operator">:</span> <span class="token comment">/* @type {(string|CacheContentTypeConfig)[]} */</span> <span class="token punctuation">[</span>
          <span class="token comment">// can be a string (the Content-Type UID)</span>
          <span class="token string">&quot;api::article.article&quot;</span><span class="token punctuation">,</span>

          <span class="token comment">// or a custom CacheContentTypeConfig object</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">&quot;api::pages.pages&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">// ...</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br></div><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>In addition to the <strong>contentType</strong> configuration, you can also set the default <strong>maxAge</strong>, <strong>hitpass</strong> and <strong>keys</strong> configuration, enables <strong>ETag</strong> and <strong>X-Cache</strong> headers or tune how the plugin will work for each route.</p>`,5),I={class:"custom-container tip"},E=n("p",{class:"custom-container-title"},"TIP",-1),P=s("Check the "),B=n("code",null,"CachePluginStrategy",-1),N=s(" and "),D=n("code",null,"CacheContentTypeConfig",-1),G=s(" configuration reference for all available options."),R=n("h3",{id:"enable-cache-on-custom-routes",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#enable-cache-on-custom-routes","aria-hidden":"true"},"#"),s(" Enable cache on custom routes")],-1),Y=s("By default the plugin registers a middleware to intercept all "),A={href:"https://docs.strapi.io/developer-docs/latest/developer-resources/database-apis-reference/rest-api.html#api-endpoints",target:"_blank",rel:"noopener noreferrer"},L=s("predefined routes"),S=s(", but you can also enable it on custom routes."),V=p(`<div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>At this time a custom route can only be registered within a single Content-Type.</p></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// file: /config/plugins.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> env <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string-property property">&#39;rest-cache&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">config</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">,</span>
      <span class="token literal-property property">provider</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">strategy</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">contentTypes</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token string">&quot;api::pages.pages&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token comment">/* @type {CacheRouteConfig[]} */</span> <span class="token punctuation">[</span>
              <span class="token punctuation">{</span>
                <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/api/pages/slug/:slug+&#39;</span><span class="token punctuation">,</span> <span class="token comment">// note that we set the /api prefix here</span>
                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> <span class="token comment">// can be omitted, defaults to GET</span>
                <span class="token literal-property property">hitpass</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// overrides default hitpass for this route</span>
                <span class="token literal-property property">keys</span><span class="token operator">:</span> <span class="token comment">/* @type {CacheKeysConfig} */</span> <span class="token punctuation">{</span>
                  <span class="token literal-property property">useQueryParams</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;locale&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// use only locale query param for keys</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><div class="highlight-line">\xA0</div><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div>`,2),U={class:"custom-container tip"},F=n("p",{class:"custom-container-title"},"TIP",-1),K=s("Check the "),z=n("code",null,"CacheRouteConfig",-1),H=s(" and "),Q=n("code",null,"CacheKeysConfig",-1),W=s(" configuration reference for all available options."),X=p('<h3 id="disable-cache-for-default-routes" tabindex="-1"><a class="header-anchor" href="#disable-cache-for-default-routes" aria-hidden="true">#</a> Disable cache for default routes</h3><h3 id="content-type-relations" tabindex="-1"><a class="header-anchor" href="#content-type-relations" aria-hidden="true">#</a> Content-Type relations</h3><h3 id="dealing-with-private-content-and-authentication" tabindex="-1"><a class="header-anchor" href="#dealing-with-private-content-and-authentication" aria-hidden="true">#</a> Dealing with private content and authentication</h3><h3 id="purging-cache-programmatically" tabindex="-1"><a class="header-anchor" href="#purging-cache-programmatically" aria-hidden="true">#</a> Purging cache programmatically</h3><h3 id="enable-debug-mode" tabindex="-1"><a class="header-anchor" href="#enable-debug-mode" aria-hidden="true">#</a> Enable debug mode</h3>',5),J=s("This plugins use "),M={href:"https://www.npmjs.com/package/debug",target:"_blank",rel:"noopener noreferrer"},O=s("debug"),Z=s(" module to log messages that can help during development. You can enable debug mode by setting the environment variable "),$=n("code",null,"DEBUG=strapi:strapi-plugin-rest-cache",-1),nn=s(" before starting strapi."),sn=n("p",null,[s("eg. "),n("code",null,"DEBUG=strapi:strapi-plugin-rest-cache yarn strapi develop")],-1),an=s("You can also enable debug mode by setting the "),en=n("code",null,"config.strategy.debug",-1),tn=s(" configuration option to "),pn=n("code",null,"true",-1),on=s(".");function rn(cn,ln){const o=i("ExternalLinkIcon"),e=i("RouterLink");return r(),c(l,null,[d,n("ul",null,[b,n("li",null,[g,m,n("a",k,[v,a(o)])])]),y,n("div",_,[f,n("p",null,[w,a(e,{to:"/documentation/memory-provider.html"},{default:t(()=>[T]),_:1}),C,a(e,{to:"/documentation/redis-provider.html"},{default:t(()=>[x]),_:1}),j])]),q,n("div",I,[E,n("p",null,[P,a(e,{to:"/documentation/configuration-reference.html#cachepluginstrategy"},{default:t(()=>[B]),_:1}),N,a(e,{to:"/documentation/configuration-reference.html#cachecontenttypeconfig"},{default:t(()=>[D]),_:1}),G])]),R,n("p",null,[Y,n("a",A,[L,a(o)]),S]),V,n("div",U,[F,n("p",null,[K,a(e,{to:"/documentation/configuration-reference.html#cacherouteconfig"},{default:t(()=>[z]),_:1}),H,a(e,{to:"/documentation/configuration-reference.html#cachekeysconfig"},{default:t(()=>[Q]),_:1}),W])]),X,n("p",null,[J,n("a",M,[O,a(o)]),Z,$,nn]),sn,n("p",null,[an,a(e,{to:"/documentation/configuration-reference.html#debug"},{default:t(()=>[en]),_:1}),tn,pn,on])],64)}var dn=u(h,[["render",rn]]);export{dn as default};
